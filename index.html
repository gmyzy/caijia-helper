<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°è¶…å¸‚è¯­éŸ³èœä»·åŠ©æ‰‹</title>
<link rel="manifest" href="manifest.json">
<style>
  body { font-family: "Microsoft Yahei", sans-serif; background: #f9fafb; padding: 20px; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  button { margin: 5px; padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; }
  #speakBtn { background: #4CAF50; color: white; }
  #saveBtn { background: #2196F3; color: white; }
  #msg { margin-top: 10px; font-weight: bold; color: #333; text-align: center; }
</style>
</head>
<body>
<h1>ğŸ›’ å°è¶…å¸‚è¯­éŸ³èœä»·åŠ©æ‰‹</h1>

<table id="priceTable">
  <thead>
    <tr><th>å•†å“</th><th>ä»·æ ¼(å…ƒ/æ–¤)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<br>
<input type="text" id="item" placeholder="å•†å“å">
<input type="number" id="price" placeholder="ä»·æ ¼">
<button id="saveBtn">ä¿å­˜ / æ›´æ–°</button>
<button id="speakBtn">ğŸ¤ è¯­éŸ³æŸ¥è¯¢</button>

<p id="msg"></p>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').then(() => {
      console.log("âœ… Service Worker å·²æ³¨å†Œ");
    });
  }

  const tableBody = document.querySelector("#priceTable tbody");
  const msg = document.getElementById("msg");
  let prices = JSON.parse(localStorage.getItem("prices")) || {
    "å¤§ç™½èœ": 2.5,
    "è¥¿çº¢æŸ¿": 3.8,
    "é»„ç“œ": 3.2
  };

  function renderTable() {
    tableBody.innerHTML = "";
    for (let [item, price] of Object.entries(prices)) {
      let tr = document.createElement("tr");
      tr.innerHTML = `<td>${item}</td><td>${price}</td>`;
      tableBody.appendChild(tr);
    }
  }
  renderTable();

  document.getElementById("saveBtn").onclick = () => {
    const item = document.getElementById("item").value.trim();
    const price = parseFloat(document.getElementById("price").value);
    if (!item || isNaN(price)) {
      msg.textContent = "è¯·è¾“å…¥å•†å“å’Œä»·æ ¼";
      return;
    }
    prices[item] = price;
    localStorage.setItem("prices", JSON.stringify(prices));
    renderTable();
    msg.textContent = `å·²ä¿å­˜ï¼š${item} = ${price} å…ƒ/æ–¤`;
  };

  function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = "zh-CN";
    speechSynthesis.speak(utterance);
  }

  document.getElementById("speakBtn").onclick = () => {
    if (!('webkitSpeechRecognition' in window)) {
      msg.textContent = "å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œè¯·ç”¨ Chrome æµè§ˆå™¨ã€‚";
      return;
    }
    const recognition = new webkitSpeechRecognition();
    recognition.lang = "zh-CN";
    recognition.start();
    msg.textContent = "ğŸ™ï¸ æ­£åœ¨å¬ï¼Œè¯·è¯´å‡ºå•†å“å...";

    recognition.onresult = (event) => {
      const result = event.results[0][0].transcript.replace("ä»Šå¤©", "").replace("å¤šå°‘é’±", "").trim();
      msg.textContent = `è¯†åˆ«åˆ°ï¼š${result}`;
      if (prices[result] !== undefined) {
        const text = `${result}ä»Šå¤©çš„ä»·æ ¼æ˜¯${prices[result]}å…ƒä¸€æ–¤`;
        msg.textContent = text;
        speak(text);
      } else {
        const text = `æ²¡æœ‰æ‰¾åˆ°${result}çš„ä»·æ ¼ä¿¡æ¯`;
        msg.textContent = text;
        speak(text);
      }
    };
    recognition.onerror = () => msg.textContent = "âŒ è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚";
  };
</script>
</body>
</html>
