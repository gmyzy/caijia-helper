<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>å°è¶…å¸‚è¯­éŸ³èœä»·åŠ©æ‰‹ï¼ˆåˆ†ç±»ç‰ˆï¼‰</title>
<link rel="manifest" href="manifest.json">
<style>
  body { font-family: "Microsoft Yahei", sans-serif; background: #f9fafb; padding: 18px; }
  h1 { text-align:center; }
  .controls { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
  select,input[type=number],input[type=text] { padding:8px; border-radius:6px; border:1px solid #ccc; }
  button { padding:9px 12px; border:none; border-radius:8px; cursor:pointer; }
  #saveBtn { background:#2196F3; color:white; }
  #speakBtn { background:#4CAF50; color:white; }
  #msg { margin-top:10px; font-weight:700; text-align:center; }
  section.category { margin-top:16px; }
  section.category h2 { background:#fff; padding:6px 8px; border-left:6px solid #4CAF50; }
  table { width:100%; border-collapse:collapse; margin-top:8px; }
  th,td { padding:6px 8px; border-bottom:1px solid #e6e6e6; text-align:left; }
  .price-cell { text-align:right; width:120px; }
</style>
</head>
<body>
<h1>ğŸ›’ å°è¶…å¸‚è¯­éŸ³èœä»·åŠ©æ‰‹ï¼ˆåˆ†ç±»ç‰ˆï¼‰</h1>

<div class="controls">
  åˆ†ç±»ï¼š
  <select id="categorySelect"></select>
  å•†å“åï¼š<input type="text" id="itemInput" placeholder="ä¾‹å¦‚ï¼šå¤§è‘±">
  ä»·æ ¼ï¼š<input type="number" id="priceInput" placeholder="å…ƒ/æ–¤">
  <button id="saveBtn">ä¿å­˜ / æ›´æ–°</button>
  <button id="speakBtn">ğŸ¤ è¯­éŸ³æŸ¥è¯¢</button>
</div>

<div id="msg"></div>

<!-- åªæ˜¾ç¤ºé€‰ä¸­åˆ†ç±»çš„åŒºåŸŸ -->
<div id="selectedCategoryList"></div>

<script>
// åˆ†ç±»ä¸å•†å“æ˜ å°„ï¼ˆä¿ç•™åŸæ•°æ®ï¼‰
const CATEGORIES = {
  "è”¬èœ": ["å¤§è‘±", "å°è‘±", "å§œ", "è€è’œ", "æ–°è’œ", "é¦™èœ", "ç™½æ´‹è‘±", "ç´«æ´‹è‘±", "é’æ¤’", "å°–æ¤’", "èºä¸æ¤’", "çº¿æ¤’", "å°çº¢è¾£æ¤’å°ç±³è¾£", "è’œè‹”", "èŒ„å­", "è‹¦èŠ", "ç”Ÿèœ", "ç”Ÿèœçƒ", "è¥¿çº¢æŸ¿", "é»„ç“œ", "å°å¨ƒå¨ƒèœ", "å¤§å¨ƒå¨ƒèœ", "è¥¿è‘«èŠ¦", "èŠ¹èœ", "è’œè‹—", "ä¸ç“œ", "é¦™èŠ¹", "å°ç™½èœ", "è¥¿å…°èŠ±", "èœèŠ±", "æ²¹éº¦", "æ²¹èœ", "è èœ", "éŸ­èœ", "èŒ´é¦™", "èƒ¡èåœ", "ç™½èåœ", "æ°´èåœ", "ç©ºå¿ƒèœ", "æ´‹ç™½èœ", "ç”˜è“", "è˜‘è‡", "é¦™è‡", "é‡‘é’ˆè‡", "æé²è‡", "æµ·é²œè‡", "è´è‹£", "èŒ¼è’¿", "é•¿è±†è§’", "ç™½ä¸è€", "è±†ç‹", "åœŸè±†", "å¤§ç™½èœ", "å†¬ç“œ", "åŒ—ç“œ", "è´è´å—ç“œ"],
  "æ°´æœ": [],
  "é¥®å“": ["å¤§çŸ¿æ³‰æ°´è“æ ‡", "å°çŸ¿æ³‰æ°´è“æ ‡", "å››å­£é˜³å…‰", "å¤§å¯ä¹æ— ç³–", "å¤§å¯ä¹ç»å…¸", "ä¸­å¯ä¹", "å°å¯ä¹", "å¤§é›ªç¢§", "ä¸­é›ªç¢§", "å°é›ªç¢§", "å¤§å†°çº¢èŒ¶", "ä¸­å†°çº¢èŒ¶", "å°å†°çº¢èŒ¶", "åº·å¸ˆå‚…ç»¿èŒ¶", "èœ‚èœœæŸšå­", "é’æ¢…ç»¿èŒ¶", "å°èŒ‰è‰èœœèŒ¶", "å°èŒ‰è‰æ¸…èŒ¶", "å¤§å†°ç³–é›ªæ¢¨", "ä¸­å†°ç³–é›ªæ¢¨", "å°–å«", "è„‰åŠ¨", "ç´«è‰²ç¾å¹´è¾¾", "ç»¿è‰²ç¾å¹´è¾¾", "é»„è‰²ç¾å¹´è¾¾", "é†’ç›®", "ç¾æ±æºæœç²’æ©™", "ä¸œæ–¹æ ‘å¶", "é»‘è‰²å¤§çª‘æ··åˆæœæ±å‘³å„¿", "ç™½è‰²å¤§çª‘è”æå‘³å„¿", "é»„è‰²å¤§çª‘æ©™å­å‘³å„¿", "è èå•¤", "å±±æ¥‚æ ‘ä¸‹", "å“‡å“ˆå“ˆ", "é˜¿è¨å§†å¥¶èŒ¶", "ç‹è€å‰", "ä¸œé¹ç‰¹é¥®", "å“‡å“ˆå“ˆå°è¥å…»å¿«çº¿", "å“‡å“ˆå“ˆå¤§è¥å…»å¿«çº¿", "å´‚å±±æ™®å•¤é…’", "å´‚å±±ç²¾å“", "å´‚å±±æ˜“æ‹‰ç½å„¿", "é’å²›", "U8"],
  "é›¶é£Ÿ": [],
  "ç†Ÿé£Ÿ": [],
  "è‚‰åˆ¶å“": [],
  "è°ƒå‘³æ–™": []
};

// ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä»·æ ¼æ•°æ®
let prices = JSON.parse(localStorage.getItem('prices') || '{}');
// åˆå§‹åŒ–é»˜è®¤ä»·æ ¼ï¼ˆå¦‚æœæœ¬åœ°æ— æ•°æ®ï¼‰
if (!prices || Object.keys(prices).length === 0) {
  prices = {
    "å¤§è‘±": 0, "å°è‘±": 0, "å§œ": 0, "è€è’œ": 0, "æ–°è’œ": 0, "é¦™èœ": 0, "ç™½æ´‹è‘±": 0, "ç´«æ´‹è‘±": 0, "é’æ¤’": 0, "å°–æ¤’": 0,
    "èºä¸æ¤’": 0, "çº¿æ¤’": 0, "å°çº¢è¾£æ¤’å°ç±³è¾£": 0, "è’œè‹”": 0, "èŒ„å­": 0, "è‹¦èŠ": 0, "ç”Ÿèœ": 0, "ç”Ÿèœçƒ": 0, "è¥¿çº¢æŸ¿": 0,
    "é»„ç“œ": 0, "å°å¨ƒå¨ƒèœ": 0, "å¤§å¨ƒå¨ƒèœ": 0, "è¥¿è‘«èŠ¦": 0, "èŠ¹èœ": 0, "è’œè‹—": 0, "ä¸ç“œ": 0, "é¦™èŠ¹": 0, "å°ç™½èœ": 0,
    "è¥¿å…°èŠ±": 0, "èœèŠ±": 0, "æ²¹éº¦": 0, "æ²¹èœ": 0, "è èœ": 0, "éŸ­èœ": 0, "èŒ´é¦™": 0, "èƒ¡èåœ": 0, "ç™½èåœ": 0,
    "æ°´èåœ": 0, "ç©ºå¿ƒèœ": 0, "æ´‹ç™½èœ": 0, "ç”˜è“": 0, "è˜‘è‡": 0, "é¦™è‡": 0, "é‡‘é’ˆè‡": 0, "æé²è‡": 0, "æµ·é²œè‡": 0,
    "è´è‹£": 0, "èŒ¼è’¿": 0, "é•¿è±†è§’": 0, "ç™½ä¸è€": 0, "è±†ç‹": 0, "åœŸè±†": 0, "å¤§ç™½èœ": 0, "å†¬ç“œ": 0, "åŒ—ç“œ": 0,
    "è´è´å—ç“œ": 0, "å¤§çŸ¿æ³‰æ°´è“æ ‡": 0, "å°çŸ¿æ³‰æ°´è“æ ‡": 0, "å››å­£é˜³å…‰": 0, "å¤§å¯ä¹æ— ç³–": 0, "å¤§å¯ä¹ç»å…¸": 0,
    "ä¸­å¯ä¹": 0, "å°å¯ä¹": 0, "å¤§é›ªç¢§": 0, "ä¸­é›ªç¢§": 0, "å°é›ªç¢§": 0, "å¤§å†°çº¢èŒ¶": 0, "ä¸­å†°çº¢èŒ¶": 0, "å°å†°çº¢èŒ¶": 0,
    "åº·å¸ˆå‚…ç»¿èŒ¶": 0, "èœ‚èœœæŸšå­": 0, "é’æ¢…ç»¿èŒ¶": 0, "å°èŒ‰è‰èœœèŒ¶": 0, "å°èŒ‰è‰æ¸…èŒ¶": 0, "å¤§å†°ç³–é›ªæ¢¨": 0, "ä¸­å†°ç³–é›ªæ¢¨": 0,
    "å°–å«": 0, "è„‰åŠ¨": 0, "ç´«è‰²ç¾å¹´è¾¾": 0, "ç»¿è‰²ç¾å¹´è¾¾": 0, "é»„è‰²ç¾å¹´è¾¾": 0, "é†’ç›®": 0, "ç¾æ±æºæœç²’æ©™": 0,
    "ä¸œæ–¹æ ‘å¶": 0, "é»‘è‰²å¤§çª‘æ··åˆæœæ±å‘³å„¿": 0, "ç™½è‰²å¤§çª‘è”æå‘³å„¿": 0, "é»„è‰²å¤§çª‘æ©™å­å‘³å„¿": 0, "è èå•¤": 0,
    "å±±æ¥‚æ ‘ä¸‹": 0, "å“‡å“ˆå“ˆ": 0, "é˜¿è¨å§†å¥¶èŒ¶": 0, "ç‹è€å‰": 0, "ä¸œé¹ç‰¹é¥®": 0, "å“‡å“ˆå“ˆå°è¥å…»å¿«çº¿": 0,
    "å“‡å“ˆå“ˆå¤§è¥å…»å¿«çº¿": 0, "å´‚å±±æ™®å•¤é…’": 0, "å´‚å±±ç²¾å“": 0, "å´‚å±±æ˜“æ‹‰ç½å„¿": 0, "é’å²›": 0, "U8": 0
  };
  localStorage.setItem('prices', JSON.stringify(prices));
}

// å¡«å……åˆ†ç±»ä¸‹æ‹‰èœå•
const categorySelect = document.getElementById('categorySelect');
Object.keys(CATEGORIES).forEach(cat => {
  const opt = document.createElement('option');
  opt.value = cat;
  opt.textContent = cat;
  categorySelect.appendChild(opt);
});

// è·å–DOMå…ƒç´ 
const itemInput = document.getElementById('itemInput');
const priceInput = document.getElementById('priceInput');
const saveBtn = document.getElementById('saveBtn');
const speakBtn = document.getElementById('speakBtn');
const msg = document.getElementById('msg');
const selectedCategoryList = document.getElementById('selectedCategoryList');

// æ¸²æŸ“å½“å‰é€‰ä¸­åˆ†ç±»çš„å•†å“åˆ—è¡¨
function renderSelectedCategoryList(selectedCat) {
  selectedCategoryList.innerHTML = '';
  // åˆ›å»ºåˆ†ç±»åŒºåŸŸ
  const section = document.createElement('section');
  section.className = 'category';
  const h2 = document.createElement('h2');
  h2.textContent = selectedCat;
  section.appendChild(h2);
  // åˆ›å»ºè¡¨æ ¼
  const tbl = document.createElement('table');
  const tbody = document.createElement('tbody');
  // è·å–å½“å‰åˆ†ç±»çš„å•†å“åˆ—è¡¨
  const items = CATEGORIES[selectedCat] || [];
  // æŒ‰åç§°æ’åº
  items.sort().forEach(it => {
    const tr = document.createElement('tr');
    const tdName = document.createElement('td');
    tdName.textContent = it;
    const tdPrice = document.createElement('td');
    tdPrice.className = 'price-cell';
    // æ˜¾ç¤ºä»·æ ¼ï¼ˆ0åˆ™ä¸æ˜¾ç¤ºå•ä½ï¼‰
    tdPrice.textContent = (prices[it] !== undefined ? prices[it] : '') + (prices[it] > 0 ? ' å…ƒ/æ–¤' : '');
    tr.appendChild(tdName);
    tr.appendChild(tdPrice);
    tbody.appendChild(tr);
  });
  tbl.appendChild(tbody);
  section.appendChild(tbl);
  selectedCategoryList.appendChild(section);
}

// åˆå§‹æ¸²æŸ“é»˜è®¤åˆ†ç±»ï¼ˆç¬¬ä¸€ä¸ªåˆ†ç±»ï¼‰
renderSelectedCategoryList(categorySelect.value);

// åˆ†ç±»ä¸‹æ‹‰èœå•åˆ‡æ¢æ—¶é‡æ–°æ¸²æŸ“
categorySelect.addEventListener('change', () => {
  renderSelectedCategoryList(categorySelect.value);
});

// ä¿å­˜/æ›´æ–°å•†å“ä»·æ ¼
saveBtn.addEventListener('click', () => {
  const cat = categorySelect.value;
  const item = itemInput.value.trim();
  const price = parseFloat(priceInput.value);
  // éªŒè¯è¾“å…¥
  if (!item || isNaN(price)) {
    msg.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„å•†å“åå’Œä»·æ ¼ï¼ˆå…ƒ/æ–¤ï¼‰';
    return;
  }
  // å°†å•†å“æ·»åŠ åˆ°å¯¹åº”åˆ†ç±»ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
  if (!CATEGORIES[cat].includes(item)) {
    CATEGORIES[cat].push(item);
    // ä¿å­˜åˆ†ç±»æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem('categories', JSON.stringify(CATEGORIES));
  }
  // æ›´æ–°ä»·æ ¼
  prices[item] = price;
  localStorage.setItem('prices', JSON.stringify(prices));
  // æç¤ºæˆåŠŸ
  msg.textContent = `å·²ä¿å­˜ï¼š${cat} - ${item} = ${price} å…ƒ/æ–¤`;
  // é‡æ–°æ¸²æŸ“å½“å‰åˆ†ç±»åˆ—è¡¨
  renderSelectedCategoryList(cat);
  // æ¸…ç©ºè¾“å…¥æ¡†
  itemInput.value = '';
  priceInput.value = '';
});

// è¯­éŸ³æ’­æŠ¥åŠŸèƒ½
function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'zh-CN';
  speechSynthesis.speak(u);
}

// è¯­éŸ³æŸ¥è¯¢åŠŸèƒ½
speakBtn.addEventListener('click', () => {
  if (!('webkitSpeechRecognition' in window)) {
    msg.textContent = 'å½“å‰æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œè¯·ä½¿ç”¨Chromeæµè§ˆå™¨';
    return;
  }
  const recognition = new webkitSpeechRecognition();
  recognition.lang = 'zh-CN';
  recognition.start();
  msg.textContent = 'ğŸ™ï¸ æ­£åœ¨å¬ï¼Œè¯·è¯´å‡ºåˆ†ç±»å’Œå•†å“ï¼ˆä¾‹å¦‚ï¼šè”¬èœå¤§è‘±å¤šå°‘é’±ï¼‰...';
  // è¯†åˆ«ç»“æœå¤„ç†
  recognition.onresult = (event) => {
    let transcript = event.results[0][0].transcript;
    msg.textContent = 'è¯†åˆ«åˆ°ï¼š' + transcript;
    // æ¸…æ´—è¯†åˆ«æ–‡æœ¬
    transcript = transcript.replace(/ä»Šå¤©|å¤šå°‘é’±|ä»·æ ¼/g, '').trim();
    // åŒ¹é…åˆ†ç±»
    let foundCategory = null;
    Object.keys(CATEGORIES).forEach(cat => {
      if (transcript.includes(cat)) foundCategory = cat;
    });
    // åŒ¹é…å•†å“
    let foundItem = null;
    const allItems = Object.keys(prices);
    // ä¼˜å…ˆåŒ¹é…é•¿åç§°å•†å“
    allItems.sort((a, b) => b.length - a.length);
    for (let it of allItems) {
      if (transcript.includes(it)) {
        foundItem = it;
        break;
      }
    }
    // åŒ¹é…æˆåŠŸåˆ™æ’­æŠ¥ä»·æ ¼
    if (foundItem && prices[foundItem] !== undefined) {
      const p = prices[foundItem];
      const categoryText = foundCategory ? `${foundCategory} ` : '';
      const text = p > 0 ? `${categoryText}${foundItem}ä»Šå¤©çš„ä»·æ ¼æ˜¯ ${p} å…ƒ/æ–¤` : `${categoryText}${foundItem}å°šæœªè®¾ç½®ä»·æ ¼`;
      msg.textContent = text;
      speak(text);
    } else {
      const text = 'æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å•†å“ä»·æ ¼ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ æˆ–æ£€æŸ¥åç§°æ˜¯å¦å‡†ç¡®';
      msg.textContent = text;
      speak(text);
    }
  };
  // è¯†åˆ«é”™è¯¯å¤„ç†
  recognition.onerror = () => {
    msg.textContent = 'âŒ è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•';
  };
});

// ä»æœ¬åœ°å­˜å‚¨åŠ è½½åˆ†ç±»æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
const savedCats = JSON.parse(localStorage.getItem('categories') || 'null');
if (savedCats) {
  Object.assign(CATEGORIES, savedCats);
}
</script>
</body>
</html>